# 🔐 TLS/SSL Handshake

---

## 📌 개요

-  TLS/SSL Handshake는 **HTTPS 통신에서 클라이언트와 서버 간**에 **신뢰성, 암호화, 무결성**을 확보하기 위한 **초기 연결 과정**

- 이 과정을 통해 서버와 클라이언트는 안전한 **대칭키**를 공유하게 되며, 이후 데이터 통신은 이 대칭키를 이용하여 빠르고 안전하게 진행

---

## 🔄 진행 순서

### 1. Client Hello
- 클라이언트 → 서버로 전송
- 포함 정보:
  - TLS 버전
  - 지원 암호화 알고리즘
  - 압축 방식
  - 랜덤 데이터 (Client Random)
  - 세션 ID 등

---

### 2. Server Hello + 인증서 전달
- 서버 → 클라이언트로 응답
- 포함 정보:
  - 선택한 암호화 알고리즘
  - 서버 인증서 (CA에 의해 서명됨)
  - 서버 랜덤 데이터 (Server Random)
  - 필요한 경우 클라이언트 인증서 요청

---

### 3. 인증서 확인 (클라이언트 측)
- 클라이언트는 받은 서버 인증서가 신뢰할 수 있는 CA에 의해 서명되었는지 **인증서 체인**을 통해 검증
- 검증 성공 시 서버의 **공개키** 획득

---

### 4. Pre-Master Secret 생성 및 전송
- 클라이언트는 **Pre-Master Secret (난수)** 를 생성
- 서버의 **공개키로 암호화** 후 서버로 전송

> 이 Pre-Master Secret은 이후 **Client Random + Server Random**과 함께 대칭키(마스터 키)를 생성하는 데 사용됨

---

### 5. (선택) 클라이언트 인증
- 서버가 요청한 경우:
  - 클라이언트는 자신의 **인증서**와
  - **개인키로 서명한 난수 바이트** 전송

---

### 6. 서버 → Pre-Master Secret 복호화
- 서버는 자신의 **개인키**로 Pre-Master Secret 복호화
- 양측은 동일한 랜덤값 기반으로 **Master Secret(대칭키)** 생성

---

### 7. Finished 메시지 (Client → Server)
- 클라이언트:
  - 지금까지의 교환 내역을 해싱한 후
  - **대칭키로 암호화**
  - `Finished` 메시지 전송

---

### 8. Finished 메시지 (Server → Client)
- 서버도 동일하게 `Finished` 메시지를 생성하고 대칭키로 암호화하여 클라이언트에게 전송

---

## 🔐 이후 통신
- 핸드셰이크 완료 후:
  - **양측은 동일한 대칭키로 암호화된 통신**을 시작
  - 모든 데이터는 SSL/TLS 프로토콜에 따라 암호화되어 안전하게 전송됨

---

## 📚 핵심 요약

| 단계             | 역할 설명                                                           |
|------------------|----------------------------------------------------------------------|
| Client Hello     | 클라이언트가 통신 조건 제안 및 랜덤값 전달                          |
| Server Hello     | 서버가 통신 조건 수락 및 인증서 전송                                 |
| 인증서 확인      | 클라이언트가 서버 공개키 신뢰성 검증                                 |
| Pre-Master 전송  | 클라이언트 → 서버, 공개키로 대칭키 암호화 전달                      |
| Finished 메시지   | 양측이 교환한 내용을 확인하고 대칭키로 암호화된 완료 메시지 전송      |
| 이후 통신        | 대칭키로 암호화된 실제 데이터 통신 시작                             |
