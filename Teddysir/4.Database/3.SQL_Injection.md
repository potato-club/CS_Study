# 💻 SQL Injection

---

> 해커에 의해 조작된 SQL 쿼리문이 데이터베이스에 그대로 전달되어 비정상적 명령을 실행시키는 공격 기법

## 1. ✅ 공격 방법

1) 인증 우회
- 로그인시 SQL 문을 입력해서 전송하는 것이다.
- 보안이 완벽하지 않은 경우, 이처럼 비밀번호와 아이디가 일치해서 True가 되고 뒤에 작성한 DELETE 문도 DB에 영향을 줄 수 있게되는 치명적ㅈ인 상황이다.

```sql
일반 로그인시 쿼리문
SELECT * FROM USER WHERE ID = "abc" AND PASSWORD = "1234";

sql injection 쿼리문
1234; DELETE * USER FROM ID = "1";
```

2) 데이터 노출
- 시스템에서 발생하는 에러 메시지를 이용해 공격하는 방법이다. 보통 에러는 개발자가 버그를 수정하는 면에서 도움을 받을 수 있는 존재인데 이를 역이용해서 구문을 삽입해서 에러를 유발
- Get방식으로 동작하는 URL 쿼리 스트링을 추가하여 에러 발생, 이를 통해 웹앱의 디비 구조를 유추하고 해킹에 활용한다.

## 2. ✅ 방어 방법

1) inpu 값을 받을 때, 특수문자 여부 검사
2) SQL 서버 오류 발생시, 해당하는 에러 메시지 감추기 ex) Slf4j log 쓰지않기
3) preparestatement 사용하기
- 이를 사용하면 특수문자를 자동으로 escaping 해준다. 이를 활용해 서버 측에서 필터링 과정을 통해서 공격을 방어


---

# 🤔 질문

### 1. sql 인젝션은 spring에서 어떻게 방어할까?

- jpa가 우선적으로 안전하게 바인딩해줘서 막아줍니다.

### 2. 다른 orm은 어떻게 방어할까?

- django에서도 orm에서 sql을 생성해서 막아줍니다. raw sql을 쓰지 않고 orm을 쓸 경우 바인딩 쿼리를 통해 사용자 입력이 쿼리 구조를 바꾸지 못하게 합니다. 이를 통해 sql injection을 막아줍니다.

